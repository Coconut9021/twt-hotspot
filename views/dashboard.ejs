<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/admin.css">
    <title>Wi-Fi Access Portal</title>
</head>
<body class="container-fluid text-center">
    <div class="row">
        <section id="navbar" class="col-1 d-flex flex-column justify-content-between offset-md-2 bg-light p-3" style="min-height: 95vh;">
            <div class="navbar-brand text-center mb-4">
                <img src="/logo.svg" alt="Tiger Wheel & Tyre logo" class="img-fluid mb-3">
            </div>
            <div class="d-grid gap-4">
                <button class="btn btn-outline-secondary toggle-btn active" data-target="full-datad">
                    <img src="/icons/overview.svg" alt="Overview">
                </button>
                <button class="btn btn-outline-secondary toggle-btn" data-target="groups">
                    <img src="/icons/groups.svg" alt="Groups">
                </button>
                <button class="btn btn-outline-secondary toggle-btn" data-target="data-usage">
                    <img src="/icons/data-usage.svg" alt="Data Usage">
                </button>
                <button class="btn btn-outline-secondary toggle-btn" data-target="all-data">
                    <img src="/icons/all-data.svg" alt="All Data">
                </button>
            </div>
            <div class="d-grid gap-2">
                <button class="btn btn-outline-secondary" href="">Settings</button>
                <a href="/logout" class="btn btn-outline-danger">Logout</a>
            </div>
        </section>
        <div class="container-fluid col-11">
            <section class="col text-start">
                <h2 class="">Welcome <%fullData.fullName%></h2>
                <p class="lead">Welcome to the Wi-Fi Access Portal Admin Dashboard</p>
            </section>
            <section class="content-section col active">
            <table id="full-datad" class=" table table-bordered table-hover">                    
                <tr>
                    <th>Full name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Company</th> 
                    <th>Terms</th>
                    <th>Marketing</th>
                    <th>Action</th>
                </tr>
                <% fullData.forEach((row, index) => { %>
                    <tr>
                        <td><%= row.fullName %></td>
                        <td><%= row.email %></td>
                        <td><%= row.phone %></td>
                        <td><%= row.company %></td>
                        <td><%= row.terms %></td>
                        <td><%= row.marketing %></td>
                        <td>
                                    <div class="row justify-content-evenly">
                                        <div role='button' class="col-1 dropdown">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M3 21V16.75L16.2 3.575C16.4 3.39167 16.6208 3.25 16.8625 3.15C17.1042 3.05 17.3583 3 17.625 3C17.8917 3 18.15 3.05 18.4 3.15C18.65 3.25 18.8667 3.4 19.05 3.6L20.425 5C20.625 5.18333 20.7708 5.4 20.8625 5.65C20.9542 5.9 21 6.15 21 6.4C21 6.66667 20.9542 6.92083 20.8625 7.1625C20.7708 7.40417 20.625 7.625 20.425 7.825L7.25 21H3ZM17.6 7.8L19 6.4L17.6 5L16.2 6.4L17.6 7.8Z" fill="#1D1B20"/>
                                            </svg>
                                        </div>
                                        <div role='button' class="col-1 delete-link" data-email="<%= row.email %>">
                                            <svg width="22" height="24" viewBox="0 0 22 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M2 6H4M4 6H20M4 6V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H16C16.5304 22 17.0391 21.7893 17.4142 21.4142C17.7893 21.0391 18 20.5304 18 20V6M7 6V4C7 3.46957 7.21071 2.96086 7.58579 2.58579C7.96086 2.21071 8.46957 2 9 2H13C13.5304 2 14.0391 2.21071 14.4142 2.58579C14.7893 2.96086 15 3.46957 15 4V6M9 11V17M13 11V17" stroke="#EC221F" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="dropdown-content">
                                        <a href="#">Edit User</a>
                                        <a href="#" class="delete-link" data-name="<%= row.fullName %>" data-email="<%= row.email %>">Delete</a>
                                    </div>
                                </div>
                            </td>
                    </tr>
                <% }) %> 
            </table>
        </section>
            <section class="content-section col">
                <table id="groups" class=" table table-hover">
                    <tr>
                        <th>Full name</th>
                        <th>Email</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                    <% groups.forEach((row, index) => { %>
                        <tr>
                            <td><%= row.fullName %></td>
                            <td><%= row.email %></td>
                            <td><%= row.GroupName %></td>
                            <td>
                                    <div class="row justify-content-evenly">
                                        <div role='button' class="col-1 dropdown">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M3 21V16.75L16.2 3.575C16.4 3.39167 16.6208 3.25 16.8625 3.15C17.1042 3.05 17.3583 3 17.625 3C17.8917 3 18.15 3.05 18.4 3.15C18.65 3.25 18.8667 3.4 19.05 3.6L20.425 5C20.625 5.18333 20.7708 5.4 20.8625 5.65C20.9542 5.9 21 6.15 21 6.4C21 6.66667 20.9542 6.92083 20.8625 7.1625C20.7708 7.40417 20.625 7.625 20.425 7.825L7.25 21H3ZM17.6 7.8L19 6.4L17.6 5L16.2 6.4L17.6 7.8Z" fill="#1D1B20"/>
                                            </svg>
                                        </div>
                                        <div role='button' class="col-1 delete-link" data-email="<%= row.email %>">
                                            <svg width="22" height="24" viewBox="0 0 22 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M2 6H4M4 6H20M4 6V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H16C16.5304 22 17.0391 21.7893 17.4142 21.4142C17.7893 21.0391 18 20.5304 18 20V6M7 6V4C7 3.46957 7.21071 2.96086 7.58579 2.58579C7.96086 2.21071 8.46957 2 9 2H13C13.5304 2 14.0391 2.21071 14.4142 2.58579C14.7893 2.96086 15 3.46957 15 4V6M9 11V17M13 11V17" stroke="#EC221F" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="dropdown-content">
                                        <a href="#">Edit User</a>
                                        <a href="#" class="delete-link" data-name="<%= row.fullName %>" data-email="<%= row.email %>">Delete</a>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    <% }) %> 
                </table>
            </section>
        </div>
    </div>
    

    <!-- Modal placed outside the table -->
    <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5">Are you sure you want to proceed</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <strong>Warning!</strong> You are about to permanently delete <strong id="userToDelete"></strong>'s data.
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete User</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete user functionality -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const deleteBtns = document.querySelectorAll('.delete-link');
            
            deleteBtns.forEach(button => {
                button.addEventListener('click', async (e) => {
                    e.preventDefault();
                    e.stopPropagation(); // Prevent event bubbling
                    
                    // Get the email from data attribute
                    const email = button.dataset.email;
                    
                    if (!email) {
                        console.error('Email not found in data attributes');
                        return;
                    }
                    
                    const confirmDelete = confirm(`Are you sure you want to delete user with email: ${email}?`);
                    
                    if (confirmDelete) {
                        try {
                            const response = await fetch('/delete-user', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({ email: email })
                            });
                            
                            const result = await response.json();
                            
                            if (result.success) {
                                // Find the closest row and remove it
                                const row = button.closest('tr');
                                if (row) {
                                    row.remove();
                                    alert('User deleted successfully');
                                }
                            } else {
                                alert('Error: ' + (result.error || 'Failed to delete user'));
                            }
                        } catch (error) {
                            console.error('Error:', error);
                            alert('An error occurred while deleting the user');
                        }
                    }
                });
            });
        });
    </script>

    <!-- Handles hiding and showing tables -->
    <script>
    
    </script>
    <!-- Bootstrap JS  -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>

    
</body>
</html>