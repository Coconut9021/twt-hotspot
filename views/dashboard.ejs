<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tiger Wheel & Tyre - Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/css/admin.css">

</head>
<body>
    <div class="container-fluid">
        <div class="row min-vh-100">
            <!-- Sidebar Navigation -->
            <section id="navbar" class="col-md-2 d-flex flex-column justify-content-between p-4">
                <div>
                    <div class="navbar-brand text-center mb-5">
                        <img class="navbar-brand" src="/logo.svg" width="100px">
                    </div>
                    <div class="d-grid gap-3">
                        <a class="btn toggle-btn active" data-target="overview-section">
                            <img class="nav-links" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxwYXRoIGQ9Ik0zIDloMThNNCAyMGgxNk0zIDE0aDE4TTQgNWgxNiI+PC9wYXRoPjwvc3ZnPg==" alt="Overview">
                            <span class="text-white ms-2">Overview</span>
                        </a>
                        <a class="btn toggle-btn" data-target="groups-section">
                            <img class="nav-links" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxjaXJjbGUgY3g9IjEyIiBjeT0iNyIgcj0iNCI+PC9jaXJjbGU+PHBhdGggZD0iTTE3IDIxaC0xMGE0IDQgMCAwIDEgLTQgLTR2LTJhNCA0IDAgMCAxIDQgLTRoMTAiPjwvcGF0aD48L3N2Zz4=" alt="Groups">
                            <span class="text-white ms-2">Groups</span>
                        </a>
                        <a class="btn toggle-btn" data-target="data-usage-section">
                            <img class="nav-links" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxwYXRoIGQ9Ik0zIDEydjRhOSA5IDAgMSAwIDE4IDB2LTRhOSA5IDAgMSAwIC0xOCAwIj48L3BhdGg+PHBvbHlsaW5lIHBvaW50cz0iMTIgMyAxMiAxMiAxNi4yNCAxNi4yNCI+PC9wb2x5bGluZT48L3N2Zz4=" alt="Data Usage">
                            <span class="text-white ms-2">Data Usage</span>
                        </a>
                        <a class="btn toggle-btn" data-target="all-data-section">
                            <img class="nav-links" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxwYXRoIGQ9Ik0zIDVhMiAyIDAgMCAxIDIgLTJoMTRhMiAyIDAgMCAxIDIgMnYxNGEyIDIgMCAwIDEgLTIgMmgtMTRhMiAyIDAgMCAxIC0yIC0yeiI+PC9wYXRoPjxwYXRoIGQ9Ik0zIDEwaDE4Ij48L3BhdGg+PHBhdGggZD0iTTEwIDEwdjgiPjwvcGF0aD48L3N2Zz4=" alt="All Data">
                            <span class="text-white ms-2">All Data</span>
                        </a>
                    </div>
                </div>
                <div class="d-grid">
                    <a href="#" class="btn btn-outline-light">
                        <i class="fas fa-sign-out-alt me-2"></i> Logout
                    </a>
                </div>
            </section>

            <!-- Main Content -->
            <main class="col-md-10 p-4">
                <!-- Welcome Section -->
                <div class="welcome-section">
                    <h2><i class="fas fa-wifi me-2"></i>Admin Dashboard</h2>
                    <p class="mb-0">Manage users, groups, and data usage from this centralized dashboard</p>
                </div>

                <!-- Overview Section -->
                <section id="overview-section" class="content-section active">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3><i class="fas fa-table me-2 text-primary"></i>Customer Data</h3>
                        <button class="btn btn-info text-white">
                            <i class="fas fa-download me-2"></i> Export
                        </button>
                    </div>
                    <div class="table-responsive">
                       <table id="full-datad" class=" table table-hover">                    
                <tr>
                    <th>Full name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Company</th> 
                    <th>Terms</th>
                    <th>Marketing</th>
                    <th>Action</th>
                </tr>
                <% fullData.forEach((row, index) => { %>
                    <tr>
                        <td><%= row.fullName %></td>
                        <td><%= row.email %></td>
                        <td><%= row.phone %></td>
                        <td><%= row.company %></td>
                        <td><%= row.terms %></td>
                        <td><%= row.marketing %></td>
                        <td>
                                    <div class="row justify-content-evenly">
                                        <div role='button' class="col-1 dropdown">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M3 21V16.75L16.2 3.575C16.4 3.39167 16.6208 3.25 16.8625 3.15C17.1042 3.05 17.3583 3 17.625 3C17.8917 3 18.15 3.05 18.4 3.15C18.65 3.25 18.8667 3.4 19.05 3.6L20.425 5C20.625 5.18333 20.7708 5.4 20.8625 5.65C20.9542 5.9 21 6.15 21 6.4C21 6.66667 20.9542 6.92083 20.8625 7.1625C20.7708 7.40417 20.625 7.625 20.425 7.825L7.25 21H3ZM17.6 7.8L19 6.4L17.6 5L16.2 6.4L17.6 7.8Z" fill="#1D1B20"/>
                                            </svg>
                                        </div>
                                        <div role='button' class="col-1 delete-link" data-email="<%= row.email %>">
                                            <svg width="22" height="24" viewBox="0 0 22 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M2 6H4M4 6H20M4 6V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H16C16.5304 22 17.0391 21.7893 17.4142 21.4142C17.7893 21.0391 18 20.5304 18 20V6M7 6V4C7 3.46957 7.21071 2.96086 7.58579 2.58579C7.96086 2.21071 8.46957 2 9 2H13C13.5304 2 14.0391 2.21071 14.4142 2.58579C14.7893 2.96086 15 3.46957 15 4V6M9 11V17M13 11V17" stroke="#EC221F" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="dropdown-content">
                                    </div>
                                </div>
                            </td>
                    </tr>
                <% }) %> 
            </table>
                    </div>
                </section>

                <!-- Groups Section -->
                <section id="groups-section" class="content-section">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3><i class="fas fa-users me-2 text-info"></i> User Groups</h3>
                        <button class="btn btn-info text-white">
                            <i class="fas fa-download me-2"></i> Export
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table id="groups" class=" table table-hover">
                        <tr>
                            <th>Full name</th>
                            <th>mail</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    <% groups.forEach((row, index) => { %>
                        <tr>
                            <td><%= row.fullName %></td>
                            <td><%= row.email %></td>
                            <td><%= row.GroupName %></td>
                            <td>
                                    <div class="row justify-content-evenly">
                                        <div role='button' class="col-1 dropdown">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M3 21V16.75L16.2 3.575C16.4 3.39167 16.6208 3.25 16.8625 3.15C17.1042 3.05 17.3583 3 17.625 3C17.8917 3 18.15 3.05 18.4 3.15C18.65 3.25 18.8667 3.4 19.05 3.6L20.425 5C20.625 5.18333 20.7708 5.4 20.8625 5.65C20.9542 5.9 21 6.15 21 6.4C21 6.66667 20.9542 6.92083 20.8625 7.1625C20.7708 7.40417 20.625 7.625 20.425 7.825L7.25 21H3ZM17.6 7.8L19 6.4L17.6 5L16.2 6.4L17.6 7.8Z" fill="#1D1B20"/>
                                            </svg>
                                        </div>
                                        <div role='button' class="col-1 delete-link" data-email="<%= row.email %>">
                                            <svg width="22" height="24" viewBox="0 0 22 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M2 6H4M4 6H20M4 6V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H16C16.5304 22 17.0391 21.7893 17.4142 21.4142C17.7893 21.0391 18 20.5304 18 20V6M7 6V4C7 3.46957 7.21071 2.96086 7.58579 2.58579C7.96086 2.21071 8.46957 2 9 2H13C13.5304 2 14.0391 2.21071 14.4142 2.58579C14.7893 2.96086 15 3.46957 15 4V6M9 11V17M13 11V17" stroke="#EC221F" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="dropdown-content">
                                    </div>
                                </div>
                            </td>
                        </tr>
                    <% }) %> 
                </table>
                    </div>
                </section>

                <!-- Data Usage Section (Placeholder) -->
                <section id="data-usage-section" class="content-section">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3><i class="fas fa-chart-bar me-2 text-success"></i> Data Usage</h3>
                        <button class="btn btn-info text-white">
                            <i class="fas fa-download me-2"></i> Export
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table id="groups" class=" table table-hover">
                            <tr>
                                <th>Email</th>
                                <th>IP Address</th>
                                <th>Upload</th>
                                <th>Download</th>
                                <th>Action</th>
                            </tr>
                        <% dataUsage.forEach((row, index) => { %>
                            <tr>
                                <td><%= row.username %></td>
                                <td><%= row.framedipaddress %></td>
                                <td><%= row.acctinputoctets / 1,048,576 %></td>
                                <td><%= row.acctoutputoctets / 1,048,576 %></td>
                                <td>
                                        <div class="row justify-content-evenly">
                                            <div role='button' class="col-1 dropdown">
                                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M3 21V16.75L16.2 3.575C16.4 3.39167 16.6208 3.25 16.8625 3.15C17.1042 3.05 17.3583 3 17.625 3C17.8917 3 18.15 3.05 18.4 3.15C18.65 3.25 18.8667 3.4 19.05 3.6L20.425 5C20.625 5.18333 20.7708 5.4 20.8625 5.65C20.9542 5.9 21 6.15 21 6.4C21 6.66667 20.9542 6.92083 20.8625 7.1625C20.7708 7.40417 20.625 7.625 20.425 7.825L7.25 21H3ZM17.6 7.8L19 6.4L17.6 5L16.2 6.4L17.6 7.8Z" fill="#1D1B20"/>
                                                </svg>
                                            </div>
                                            <div role='button' class="col-1 delete-link" data-email="<%= row.email %>">
                                                <svg width="22" height="24" viewBox="0 0 22 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M2 6H4M4 6H20M4 6V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H16C16.5304 22 17.0391 21.7893 17.4142 21.4142C17.7893 21.0391 18 20.5304 18 20V6M7 6V4C7 3.46957 7.21071 2.96086 7.58579 2.58579C7.96086 2.21071 8.46957 2 9 2H13C13.5304 2 14.0391 2.21071 14.4142 2.58579C14.7893 2.96086 15 3.46957 15 4V6M9 11V17M13 11V17" stroke="#EC221F" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                                                </svg>
                                            </div>
                                        </div>
                                        <div class="dropdown-content">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        <% }) %> 
                        </table>                
                    </div>
                    
                </section>

                <!-- All Data Section (Placeholder) -->
                <section id="groups-section" class="content-section">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3><i class="fas fa-users me-2 text-info"></i> User Groups</h3>
                        <button class="btn btn-info text-white">
                            <i class="fas fa-download me-2"></i> Export
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table id="groups" class=" table table-hover">
                        <tr>
                            <th>Full name</th>
                            <th>Email</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    <% groups.forEach((row, index) => { %>
                        <tr>
                            <td><%= row.fullName %></td>
                            <td><%= row.email %></td>
                            <td><%= row.GroupName %></td>
                            <td>
                                    <div class="row justify-content-evenly">
                                        <div role='button' class="col-1 dropdown">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M3 21V16.75L16.2 3.575C16.4 3.39167 16.6208 3.25 16.8625 3.15C17.1042 3.05 17.3583 3 17.625 3C17.8917 3 18.15 3.05 18.4 3.15C18.65 3.25 18.8667 3.4 19.05 3.6L20.425 5C20.625 5.18333 20.7708 5.4 20.8625 5.65C20.9542 5.9 21 6.15 21 6.4C21 6.66667 20.9542 6.92083 20.8625 7.1625C20.7708 7.40417 20.625 7.625 20.425 7.825L7.25 21H3ZM17.6 7.8L19 6.4L17.6 5L16.2 6.4L17.6 7.8Z" fill="#1D1B20"/>
                                            </svg>
                                        </div>
                                        <div role='button' class="col-1 delete-link" data-email="<%= row.email %>">
                                            <svg width="22" height="24" viewBox="0 0 22 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M2 6H4M4 6H20M4 6V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H16C16.5304 22 17.0391 21.7893 17.4142 21.4142C17.7893 21.0391 18 20.5304 18 20V6M7 6V4C7 3.46957 7.21071 2.96086 7.58579 2.58579C7.96086 2.21071 8.46957 2 9 2H13C13.5304 2 14.0391 2.21071 14.4142 2.58579C14.7893 2.96086 15 3.46957 15 4V6M9 11V17M13 11V17" stroke="#EC221F" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="dropdown-content">
                                    </div>
                                </div>
                            </td>
                        </tr>
                    <% }) %> 
                </table>
                    </div>
                </section>

                <!-- Data Usage Section (Placeholder) -->
                <section id="data-usage-section" class="content-section">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3><i class="fas fa-chart-bar me-2 text-success"></i> Data Usage</h3>
                        <button class="btn btn-success">
                            <i class="fas fa-download me-2"></i> Export
                        </button> 
                    </div>
                    <div class="table-responsive">
                        <table id="groups" class=" table table-hover">
                        <tr>
                            <th>Full name</th>
                            <th>Email</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    <% groups.forEach((row, index) => { %>
                        <tr>
                            <td><%= row.fullName %></td>
                            <td><%= row.email %></td>
                            <td><%= row.GroupName %></td>
                            <td>
                                    <div class="row justify-content-evenly">
                                        <div role='button' class="col-1 dropdown">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M3 21V16.75L16.2 3.575C16.4 3.39167 16.6208 3.25 16.8625 3.15C17.1042 3.05 17.3583 3 17.625 3C17.8917 3 18.15 3.05 18.4 3.15C18.65 3.25 18.8667 3.4 19.05 3.6L20.425 5C20.625 5.18333 20.7708 5.4 20.8625 5.65C20.9542 5.9 21 6.15 21 6.4C21 6.66667 20.9542 6.92083 20.8625 7.1625C20.7708 7.40417 20.625 7.625 20.425 7.825L7.25 21H3ZM17.6 7.8L19 6.4L17.6 5L16.2 6.4L17.6 7.8Z" fill="#1D1B20"/>
                                            </svg>
                                        </div>
                                        <div role='button' class="col-1 delete-link" data-email="<%= row.email %>">
                                            <svg width="22" height="24" viewBox="0 0 22 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M2 6H4M4 6H20M4 6V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H16C16.5304 22 17.0391 21.7893 17.4142 21.4142C17.7893 21.0391 18 20.5304 18 20V6M7 6V4C7 3.46957 7.21071 2.96086 7.58579 2.58579C7.96086 2.21071 8.46957 2 9 2H13C13.5304 2 14.0391 2.21071 14.4142 2.58579C14.7893 2.96086 15 3.46957 15 4V6M9 11V17M13 11V17" stroke="#EC221F" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="dropdown-content">
                                    </div>
                                </div>
                            </td>
                        </tr>
                    <% }) %> 
                </table>
                    </div>
                    
                </section>
            </main>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get all toggle buttons
            const toggleButtons = document.querySelectorAll('.toggle-btn');
            
            // Add click event listeners to each button
            toggleButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // Remove active class from all buttons
                    toggleButtons.forEach(btn => btn.classList.remove('active'));
                    
                    // Add active class to clicked button
                    this.classList.add('active');
                    
                    // Get target section ID
                    const targetId = this.getAttribute('data-target');
                    
                    // Hide all sections
                    document.querySelectorAll('.content-section').forEach(section => {
                        section.classList.remove('active');
                    });
                    
                    // Show target section
                    document.getElementById(targetId).classList.add('active');
                });
            });
            
            // Add functionality to action buttons
            const actionButtons = document.querySelectorAll('.action-btn');
            actionButtons.forEach(button => {
                button.addEventListener('click', function() {
                    if (this.classList.contains('edit-btn')) {
                        alert('Edit functionality would open here');
                    } else if (this.classList.contains('delete-btn')) {
                        if (confirm('Are you sure you want to delete this item?')) {
                            alert('Item would be deleted now');
                        }
                    }
                });
            });
        });
    </script>

    <!-- Delete user functionality -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const deleteBtns = document.querySelectorAll('.delete-link');
            
            deleteBtns.forEach(button => {
                button.addEventListener('click', async (e) => {
                    e.preventDefault();
                    e.stopPropagation(); // Prevent event bubbling
                    
                    // Get the email from data attribute
                    const email = button.dataset.email;
                    
                    if (!email) {
                        console.error('Email not found in data attributes');
                        return;
                    }
                    
                    const confirmDelete = confirm(`Are you sure you want to delete user with email: ${email}?`);
                    
                    if (confirmDelete) {
                        try {
                            const response = await fetch('/delete-user', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({ email: email })
                            });
                            
                            const result = await response.json();
                            
                            if (result.success) {
                                // Find the closest row and remove it
                                const row = button.closest('tr');
                                if (row) {
                                    row.remove();
                                    alert('User deleted successfully');
                                }
                            } else {
                                alert('Error: ' + (result.error || 'Failed to delete user'));
                            }
                        } catch (error) {
                            console.error('Error:', error);
                            alert('An error occurred while deleting the user');
                        }
                    }
                });
            });
        });
    </script>
</body>
</html>